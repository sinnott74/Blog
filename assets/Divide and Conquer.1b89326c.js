var e=Object.defineProperty,n=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(n,t,r)=>t in n?e(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;import"./vendor.0d5e54d3.js";import{N as a}from"./mdx-react.modern.650372c4.js";const s="Divide and Conquer",i="Daniel Sinnott",l="https://i.imgur.com/2Poehrs.png",p=21,c=["Technical","ExpressJS","NGINX","Microservices"],h="Mon, 9th Jul 2018",u=new Date(1531153042885);function m(e){var s=e,{components:i}=s,l=((e,o)=>{var a={};for(var s in e)t.call(e,s)&&o.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&n)for(var s of n(e))o.indexOf(s)<0&&r.call(e,s)&&(a[s]=e[s]);return a})(s,["components"]);return a("wrapper",((e,a)=>{for(var s in a||(a={}))t.call(a,s)&&o(e,s,a[s]);if(n)for(var s of n(a))r.call(a,s)&&o(e,s,a[s]);return e})({components:i},l),a("h2",null,"Monolith"),a("p",null,"This application was originally designed as a monolith & built using ",a("a",{href:"https://www.cloudfoundry.org",parentName:"p"},"Cloud Foundry"),"'s NodeJS\nbuildpack. The web client & the corresponding API calls were served by the same application. It\nallowed for an ease of development and straight forward deployment."),a("h2",null,"Designing for Scale"),a("p",null,"The ",a("a",{href:"https://expressjs.com/en/advanced/best-practice-performance.html#use-a-reverse-proxy",parentName:"p"},"Express documentation")," recommends the use of a reverse proxy to deliver web client file and\noffloading any API calls to the express server."),a("blockquote",null,a("p",{parentName:"blockquote"},"A reverse proxy sits in front of a web app and performs supporting operations on the requests,\napart from directing requests to the app. It can handle error pages, compression, caching, serving\nfiles, and load balancing among other things."),a("p",{parentName:"blockquote"},"Handing over tasks that do not require knowledge of application state to a reverse proxy frees up\nExpress to perform specialized application tasks. For this reason, it is recommended to run\nExpress behind a reverse proxy like Nginx or HAProxy in production.")),a("p",null,"In essence, express should only be used as an API server as thats where it excels. Nodejs utilises a\nsingle thread and an event loop concurrency model to run its applications (See ",a("a",{href:"/blog/7",parentName:"p"},"Node event loop")," for\nmore). As such, we don't want our resources being consumed by compressing and serving static files.\n",a("a",{href:"https://www.nginx.com/resources/wiki/",parentName:"p"},"NGINX")," was designed perform these tasks."),a("blockquote",null,a("p",{parentName:"blockquote"},"NGINX is a free, open-source, high-performance HTTP server")),a("p",null,a("img",{src:"https://i.imgur.com/ZbQYWeA.png",alt:"Reverse Proxy",title:"Reverse Proxy",parentName:"p"})),a("h2",null,"Separation of Concerns"),a("p",null,"Separating out the web server from the API server allows each to be developed separately. It also\nallows us to scale out each service independently of the other. For example, if we were to introduce\na native mobile version of this application and it was to become extremely popular, we may need to\ndeploy several more instances of the API server, but the nginx web client could be left as it is."),a("p",null,"This application has been split as described above. The client and server can be found at ",a("a",{href:"https://github.com/sinnott74/BlogWebClient",parentName:"p"},"Blog\nWebclient")," and ",a("a",{href:"https://github.com/sinnott74/BlogServer",parentName:"p"},"Blog Server")," respectively."),a("p",null,"All requests are currently routed through the NGINX server. Any request to /api/ is forwarded onto\nthe API server using the following snippet from the web client's nginx.conf:"),a("pre",null,a("code",{parentName:"pre"},'location /api/ {\n    proxy_pass <%= ENV["BACKEND_ADDR"] %>;\n}\n')),a("p",null,"BACKEND_ADDR is an environment variable which points to my backend server. This follows along the\nlines of the ",a("a",{href:"https://12factor.net/",parentName:"p"},"12 Factor App"),"."),a("blockquote",null,a("p",{parentName:"blockquote"},"The twelve-factor app stores config in environment variables (often shortened to env vars or env).\nEnv vars are easy to change between deploys without changing any code; unlike config files, there\nis little chance of them being checked into the code repo accidentally; and unlike custom config\nfiles, or other config mechanisms such as Java System Properties, they are a language- and\nOS-agnostic standard.")),a("h2",null,"Performance"),a("p",null,"Webclient rendering has seen a 10% gain in performance from the change, which can be seen in graph\nbelow which compares data from ",a("a",{href:"https://www.webpagetest.org/",parentName:"p"},"WebPageTest"),". SinnottTest.eu-gb.mybluemix.net is the development\napplication which is using this new architecture, which Sinnott.eu-gb.mybluemix.net is the old\nmonolith."),a("p",null,a("img",{src:"https://i.imgur.com/d8aeKvO.png",alt:"Visual Progress",title:"Visual Progress",parentName:"p"}),"\n",a("img",{src:"https://i.imgur.com/tfnZv0n.png",alt:"Resource Timings",title:"Resource Timings",parentName:"p"})))}m.isMDXComponent=!0;export default m;export{i as author,u as created,h as date,p as id,l as imageurl,c as tags,s as title};
